<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>App Store Icon Extractor</title>  
    <style>  
        /* CSS 变量定义 */  
        :root {  
            --primary-color: #007AFF;  
            --secondary-color: #0056b3;  
            --text-color: #333;  
            --background-color: #f5f5f7;  
        }  

        /* 全局样式 */  
        body {  
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;  
            max-width: 1000px;  
            margin: 0 auto;  
            padding: 20px;  
            text-align: center;  
            display: flex;  
            flex-direction: column;  
            min-height: 100vh;  
            justify-content: center;  
            background-color: var(--background-color);  
            color: var(--text-color);  
        }  

        /* 标题样式 */  
        h1 {  
            margin-bottom: 20px;  
            color: var(--text-color);  
        }  

        /* 搜索表单样式 */  
        #search-form {  
            margin-bottom: 64px;  
            position: relative;  
            display: inline-block;  
        }  

        /* 搜索输入框样式 */  
        #search-input {  
            width: 320px;  
            height: 40px;  
            padding: 0 40px 0 12px;  
            font-size: 16px;  
            border: 1px solid #ccc;  
            border-radius: 20px;  
            box-sizing: border-box;  
            transition: all 0.3s ease;  
        }  

        /* 搜索输入框焦点样式 */  
        #search-input:focus {  
            outline: none;  
            border-color: var(--primary-color);  
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);  
        }  

        /* 清除搜索按钮样式 */  
        #clear-search {  
            position: absolute;  
            right: 12px;  
            top: 50%;  
            transform: translateY(-50%);  
            background: none;  
            border: none;  
            font-size: 18px;  
            cursor: pointer;  
            color: #999;  
            display: none;  
            padding: 0;  
            line-height: 1;  
            transition: color 0.3s ease;  
        }  

        /* 清除搜索按钮悬停样式 */  
        #clear-search:hover {  
            color: var(--text-color);  
        }  

        /* 结果容器样式 */  
        #results {  
            display: flex;  
            flex-wrap: wrap;  
            justify-content: center; /* 修改为居中对齐 */  
            gap: 40px;  
            margin-bottom: 80px;  
            min-height: 200px;  
        }  

        /* 应用图标容器样式 */  
        .app-icon {  
            text-align: center;  
            width: 120px;  
            transition: transform 0.3s ease;  
        }  

        /* 应用图标容器悬停效果 */  
        .app-icon:hover {  
            transform: translateY(-5px);  
        }  

        /* 应用图标样式 */  
        .app-icon img {  
            width: 100px;  
            height: 100px;  
            object-fit: cover;  
            border-radius: 22px;  
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);  
            transition: transform 0.3s ease;  
        }  

        /* 应用图标悬停效果 */  
        .app-icon img:hover {  
            transform: scale(1.05);  
        }  

        /* 应用名称样式 */  
        .app-icon p {  
            margin: 10px 0;  
            white-space: nowrap;  
            overflow: hidden;  
            text-overflow: ellipsis;  
            font-size: 14px;  
            color: var(--text-color);  
        }  

        /* 下载按钮样式 */  
        .download-btn {  
            margin-top: 10px;  
            padding: 8px 16px;  
            background-color: var(--primary-color);  
            color: white;  
            border: none;  
            border-radius: 20px;  
            cursor: pointer;  
            transition: background-color 0.3s ease;  
            font-size: 14px;  
        }  

        /* 下载按钮悬停效果 */  
        .download-btn:hover {  
            background-color: var(--secondary-color);  
        }  

        /* 无结果提示样式 */  
        #no-results {  
            display: flex;  
            justify-content: center;  
            align-items: center;  
            height: 200px;  
            width: 100%;  
            color: #999;  
            font-size: 16px;  
        }  

        /* 响应式布局 */  
        @media (max-width: 600px) {  
            #search-input {  
                width: 100%;  
            }  
            #results {  
                gap: 20px;  
            }  
        }  
    </style>  
</head>  
<body>  
    <h1>App Store Icon Extractor</h1>  
    <!-- 搜索表单 -->  
    <form id="search-form">  
        <div style="position: relative; display: inline-block;">  
            <input type="text" id="search-input" placeholder="Enter app name" required>  
            <button type="button" id="clear-search" aria-label="Clear search">&times;</button>  
        </div>  
    </form>  
    <!-- 结果显示区域 -->  
    <div id="results"></div>  

    <script>  
        // 获取 DOM 元素  
        const searchForm = document.getElementById('search-form');  
        const searchInput = document.getElementById('search-input');  
        const clearSearch = document.getElementById('clear-search');  
        const resultsDiv = document.getElementById('results');  

        // 添加事件监听器  
        searchForm.addEventListener('submit', handleSearch);  
        clearSearch.addEventListener('click', clearSearchInput);  
        searchInput.addEventListener('input', toggleClearButton);  

        // 处理搜索  
        async function handleSearch(e) {  
            e.preventDefault();  
            const searchTerm = searchInput.value.trim();  
            if (!searchTerm) return;  
            const results = await searchApps(searchTerm);  
            displayResults(results);  
            document.body.style.justifyContent = 'flex-start';  
        }  

        // 清除搜索输入  
        function clearSearchInput() {  
            searchInput.value = '';  
            searchInput.focus();  
            clearSearch.style.display = 'none';  
            resultsDiv.innerHTML = '';  
            document.body.style.justifyContent = 'center';  
        }  

        // 切换清除按钮的显示  
        function toggleClearButton() {  
            clearSearch.style.display = searchInput.value ? 'block' : 'none';  
        }  

        // 搜索应用  
        async function searchApps(term) {  
            try {  
                const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(term)}&entity=software&limit=20`);  
                if (!response.ok) throw new Error('Network response was not ok');  
                const data = await response.json();  
                return data.results;  
            } catch (error) {  
                console.error('Error:', error);  
                return [];  
            }  
        }  

        // 显示搜索结果  
        function displayResults(apps) {  
            resultsDiv.innerHTML = '';  
            if (apps.length === 0) {  
                resultsDiv.innerHTML = '<div id="no-results">No results found. Please try another search.</div>';  
                return;  
            }  
            const fragment = document.createDocumentFragment();  
            apps.forEach(app => {  
                const iconUrl = app.artworkUrl512 || app.artworkUrl100;  
                const appName = app.trackName;  
                const appDiv = document.createElement('div');  
                appDiv.className = 'app-icon';  
                appDiv.innerHTML = `  
                    <img src="${iconUrl}" alt="${appName}" loading="lazy">  
                    <p title="${appName}">${appName}</p>  
                    <button class="download-btn" data-url="${iconUrl}" data-name="${appName}">Download</button>  
                `;  
                fragment.appendChild(appDiv);  
            });  
            resultsDiv.appendChild(fragment);  
            resultsDiv.addEventListener('click', handleDownload);  
        }  

        // 处理下载操作  
        function handleDownload(e) {  
            if (e.target.classList.contains('download-btn')) {  
                const url = e.target.dataset.url;  
                const name = e.target.dataset.name;  
                downloadIcon(url, name);  
            }  
        }  

        // 下载图标  
        async function downloadIcon(url, name) {  
            try {  
                const response = await fetch(url);  
                const blob = await response.blob();  
                const link = document.createElement('a');  
                link.href = URL.createObjectURL(blob);  
                const safeName = name.replace(/[^a-z0-9]/gi, '_').toLowerCase();  
                link.download = `${safeName}_icon.jpg`;  
                link.click();  
                URL.revokeObjectURL(link.href);  
            } catch (error) {  
                console.error('Download failed:', error);  
                alert('Download failed. Please try again.');  
            }  
        }  
    </script>  
</body>  
</html>