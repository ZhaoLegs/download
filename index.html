<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>App Store & Google Play Icon Extractor</title>  
    <style>  
        :root {  
            --background-color: #f5f5f7;  
            --text-color: #333;  
            --primary-color: #007aff;  
            --secondary-color: #0056b3;  
        }  

        body {  
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;  
            max-width: 1000px;  
            margin: 0 auto;  
            padding: 20px;  
            text-align: center;  
            display: flex;  
            flex-direction: column;  
            min-height: 100vh;  
            justify-content: center;  
            background-color: var(--background-color);  
            color: var(--text-color);  
        }  

        h1 {  
            margin-bottom: 24px;  
            color: var(--text-color);  
        }  

        #search-form {  
            margin-bottom: 64px;  
            position: relative;  
            display: inline-block;  
        }  

        #search-input {  
            width: 320px;  
            height: 40px;  
            padding: 0 40px 0 12px;  
            font-size: 14px;  
            border: 1px solid #ccc;  
            border-radius: 20px;  
            box-sizing: border-box;  
            transition: all 0.3s ease;  
        }  

        #search-input:focus {  
            outline: none;  
            border-color: var(--primary-color);  
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);  
        }  

        #clear-search {  
            position: absolute;  
            right: 12px;  
            top: 50%;  
            transform: translateY(-50%);  
            background: none;  
            border: none;  
            font-size: 18px;  
            cursor: pointer;  
            color: #999;  
            display: none;  
            padding: 0;  
            line-height: 1;  
            transition: color 0.3s ease;  
        }  

        #clear-search:hover {  
            color: var(--text-color);  
        }  

        #loading-indicator {  
            display: none;  
            position: absolute;  
            top: 50%;  
            left: 50%;  
            transform: translate(-50%, -50%);  
            border: 4px solid #f3f3f3;  
            border-top: 4px solid var(--primary-color);  
            border-radius: 50%;  
            width: 30px;  
            height: 30px;  
            animation: spin 2s linear infinite;  
        }  

        @keyframes spin {  
            0% { transform: rotate(0deg); }  
            100% { transform: rotate(360deg); }  
        }  

        #results {  
            display: flex;  
            flex-wrap: wrap;  
            justify-content: center;  
            gap: 40px;  
            margin-bottom: 80px;  
            min-height: 200px;  
        }  

        .app-icon {  
            text-align: center;  
            width: 120px;  
            transition: transform 0.3s ease;  
            cursor: pointer;  
        }  

        .app-icon:hover {  
            transform: translateY(-5px);  
        }  

        .app-icon img {  
            width: 100px;  
            height: 100px;  
            object-fit: cover;  
            border-radius: 22px;  
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);  
            transition: transform 0.3s ease;  
        }  

        .app-icon img:hover {  
            transform: scale(1.05);  
        }  

        .app-icon p {  
            margin: 10px 0;  
            white-space: nowrap;  
            overflow: hidden;  
            text-overflow: ellipsis;  
            font-size: 14px;  
            color: var(--text-color);  
        }  

        .download-btn {  
            margin-top: 10px;  
            padding: 8px 16px;  
            background-color: var(--primary-color);  
            color: white;  
            border: none;  
            border-radius: 20px;  
            cursor: pointer;  
            transition: background-color 0.3s ease;  
            font-size: 14px;  
        }  

        .download-btn:hover {  
            background-color: var(--secondary-color);  
        }  

        #no-results {  
            display: flex;  
            justify-content: center;  
            align-items: center;  
            height: 200px;  
            width: 100%;  
            color: #999;  
            font-size: 16px;  
        }  

        @media (max-width: 600px) {  
            #search-input {  
                width: 100%;  
            }  
            #results {  
                gap: 20px;  
            }  
        }  
    </style>  
</head>  
<body>  
    <h1>App Store & Google Play Icon Extractor</h1>  
    <form id="search-form">  
        <div style="position: relative; display: inline-block;">  
            <input type="text" id="search-input" placeholder="Enter app name" required>  
            <button type="button" id="clear-search" aria-label="Clear search">&times;</button>  
        </div>  
    </form>  
    <div id="loading-indicator"></div>  
    <div id="results"></div>  

    <script>  
        const searchForm = document.getElementById('search-form');  
        const searchInput = document.getElementById('search-input');  
        const clearSearch = document.getElementById('clear-search');  
        const resultsDiv = document.getElementById('results');  
        const loadingIndicator = document.getElementById('loading-indicator');  

        searchForm.addEventListener('submit', handleSearch);  
        clearSearch.addEventListener('click', clearSearchInput);  
        searchInput.addEventListener('input', handleInputChange);  

        async function handleSearch(e) {  
            e.preventDefault();  
            const searchTerm = searchInput.value.trim();  
            if (!searchTerm) return;  

            loadingIndicator.style.display = 'block';  

            const appStoreResults = await Promise.all([  
                searchAppStoreApps(searchTerm, 'us'),  
                searchAppStoreApps(searchTerm, 'cn')  
            ]);  
            const googlePlayResults = await searchGooglePlayApps(searchTerm);  
            const allResults = [...appStoreResults.flat(), ...googlePlayResults];  

            loadingIndicator.style.display = 'none';  

            const sortedResults = await sortResultsByRelevance(allResults, searchTerm);  
            displayResults(sortedResults);  
            document.body.style.justifyContent = 'flex-start';  
        }  

        function clearSearchInput() {  
            searchInput.value = '';  
            searchInput.focus();  
            clearSearch.style.display = 'none';  
            resultsDiv.innerHTML = '';  
            document.body.style.justifyContent = 'center';  
        }  

        function handleInputChange() {  
            toggleClearButton();  
            if (!searchInput.value) {  
                clearSearchInput();  
            }  
        }  

        function toggleClearButton() {  
            clearSearch.style.display = searchInput.value ? 'block' : 'none';  
        }  

        async function sortResultsByRelevance(apps, searchTerm) {  
            return apps.sort(async (a, b) => {  
                const nameScoreA = await calculateNameScore(a.trackName, searchTerm);  
                const nameScoreB = await calculateNameScore(b.trackName, searchTerm);  
                return nameScoreA - nameScoreB;  
            });  
        }  

        async function calculateNameScore(name, searchTerm) {  
            const regex = new RegExp(searchTerm, 'i');  
            const match = name.match(regex);  
            if (match) {  
                const distance = match.index;  
                const normalizedDistance = distance / name.length;  
                return normalizedDistance;  
            } else {  
                return 1;  
            }  
        }  

        async function searchAppStoreApps(term, country) {  
            try {  
                const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(term)}&entity=software&limit=20&country=${country}`);  
                if (!response.ok) throw new Error('Network response was not ok');  
                const data = await response.json();  
                return data.results;  
            } catch (error) {  
                console.error('Error:', error);  
                return [];  
            }  
        }  

        async function searchGooglePlayApps(term) {  
            try {  
                const response = await fetch(`https://play.google.com/store/search?q=${encodeURIComponent(term)}&c=apps`);  
                if (!response.ok) throw new Error('Network response was not ok');  
                const data = await response.text();  
                const parser = new DOMParser();  
                const doc = parser.parseFromString(data, 'text/html');  
                const apps = Array.from(doc.querySelectorAll('.ULeU3b')).map(app => ({  
                    artworkUrl512: app.querySelector('img').src,  
                    trackName: app.querySelector('.WsMG1c.nnK0zc').textContent,  
                    url: `https://play.google.com/store/apps/details?id=${app.dataset.docid}`  
                }));  
                return apps;  
            } catch (error) {  
                console.error('Error:', error);  
                return [];  
            }  
        }  

        function displayResults(apps) {  
            resultsDiv.innerHTML = '';  
            if (apps.length === 0) {  
                resultsDiv.innerHTML = '<div id="no-results">No results found. Please try another search.</div>';  
                return;  
            }  

            const uniqueApps = new Map();  
            apps.forEach(app => {  
                const key = `${app.artworkUrl512 || app.artworkUrl100}-${app.trackName}`;  
                if (!uniqueApps.has(key)) {  
                    uniqueApps.set(key, app);  
                }  
            });  

            const fragment = document.createDocumentFragment();  
            uniqueApps.forEach(app => {  
                const iconUrl = app.artworkUrl512 || app.artworkUrl100;  
                const appName = app.trackName;  
                const appUrl = app.url || `https://apps.apple.com/app/id${app.trackId}`;  
                const appDiv = document.createElement('div');  
                appDiv.className = 'app-icon';  
                appDiv.addEventListener('click', () => navigateToApp(appUrl));  
                appDiv.innerHTML = `  
                    <img src="${iconUrl}" alt="${appName}" loading="lazy">  
                    <p title="${appName}">${appName}</p>  
                    <button class="download-btn" data-url="${iconUrl}" data-name="${appName}">Download</button>  
                `;  
                fragment.appendChild(appDiv);  
            });  
            resultsDiv.appendChild(fragment);  
            resultsDiv.addEventListener('click', handleDownload);  
        }  

        function navigateToApp(url) {  
            window.open(url, '_blank');  
        }  

        function handleDownload(e) {  
            if (e.target.classList.contains('download-btn')) {  
                const url = e.target.dataset.url;  
                const name = e.target.dataset.name;  
                downloadIcon(url, name);  
            }  
        }  

        async function downloadIcon(url, name) {  
            try {  
                const response = await fetch(url);  
                const blob = await response.blob();  
                const link = document.createElement('a');  
                link.href = URL.createObjectURL(blob);  
                const safeName = name.replace(/[^a-z0-9]/gi, '_').toLowerCase();  
                link.download = `${safeName}_icon.jpg`;  
                link.click();  
                URL.revokeObjectURL(link.href);  
            } catch (error) {  
                console.error('Download failed:', error);  
                alert('Download failed. Please try again.');  
            }  
        }  
    </script>  
</body>  
</html>
